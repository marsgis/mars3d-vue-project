<p align="center">
<img src="//mars3d.cn/logo.png" width="300px" />
</p>

<p align="center">åŸºäºVue3.xæŠ€æœ¯æ ˆçš„ Mars3DğŸŒåŸºç¡€é¡¹ç›®ç³»ç»Ÿ</p>

<p align="center">
  <a target="_black" href="https://www.npmjs.com/package/mars3d">
    <img alt="Npm version" src="https://img.shields.io/npm/v/mars3d.svg?style=flat&logo=npm&label=ç‰ˆæœ¬å·" />
  </a>
  <a target="_black" href="https://www.npmjs.com/package/mars3d">
    <img alt="Npm downloads" src="https://img.shields.io/npm/dt/mars3d?style=flat&logo=npm&label=ä¸‹è½½é‡" />
  </a>
  <a target="_black" href="https://github.com/marsgis/mars3d">
    <img alt="GitHub stars" src="https://img.shields.io/github/stars/marsgis/mars3d?style=flat&logo=github" />
  </a>
  <a target="_black" href="https://gitee.com/marsgis/mars3d">
    <img src="https://gitee.com/marsgis/mars3d/badge/star.svg?theme=dark" alt="star" />
  </a>
</p>

## é¡¹ç›®ä»‹ç»

Mars3D åŸºç¡€é¡¹ç›® æ˜¯åŸºäº[Mars3D å¹³å°](http://mars3d.cn)åšçš„ä¸€ä¸ªåº”ç”¨ç³»ç»Ÿï¼Œæä¾›çš„ä¸€ä¸ªåŸºç¡€é¡¹ç›®æ¨¡ç‰ˆï¼ŒåŒ…å«å¸¸ç”¨åŸºç¡€åœ°å›¾åŠŸèƒ½ï¼Œå¯åœ¨è¯¥åŸºç¡€é¡¹ç›®ä¸Šå¿«é€Ÿå¼€å‘æ­å»ºæ–°é¡¹ç›®ã€‚æ–¹ä¾¿å¿«é€Ÿæ­å»ºä¸‰ç»´åœ°å›¾äº§å“ï¼Œæ•æ·å¼€å‘ï¼Œå¯å¤ç”¨ï¼Œæ”¯æŒå„ç§é…ç½®ï¼Œé€‚åˆå„ç§åœºæ™¯ä½¿ç”¨ã€‚
 
 
## é¡¹ç›®ç‰¹æ€§ 
- **æœ€æ–°æŠ€æœ¯æ ˆ**ï¼šä½¿ç”¨ Vue3/vite2 ç­‰å‰ç«¯å‰æ²¿æŠ€æœ¯å¼€å‘
- **TypeScript**: åº”ç”¨ç¨‹åºçº§ JavaScript çš„è¯­è¨€
- **é€‚ç”¨äºåœ°å›¾åœºæ™¯çš„widgetæ¨¡å—åŒ–**: ç»§ç»­æ²¿ç”¨äº†åŸç”Ÿ JS ç‰ˆæœ¬ widget æ¶æ„çš„ä¸€äº›æ€æƒ³ï¼Œä½¿ç”¨ vue æ–¹å¼å®ç°äº†å„ widget åŠŸèƒ½
 

 > å¦‚æœæ‚¨ä¸ç†Ÿæ‚‰Vueï¼Œä¹Ÿå¯ä»¥é˜…è¯»ï¼š[åŸºç¡€é¡¹ç›®åŸç”ŸJSç‰ˆ](http://mars3d.cn/dev/guide/project/jcxm-es5.html)  ã€[åŸºç¡€é¡¹ç›®Reactç‰ˆ](http://mars3d.cn/dev/guide/project/jcxm-react.html)

 


## è§†é¢‘è®²è§£

å»ºè®®å…ˆçœ‹ä¸€éè§†é¢‘è®²è§£ï¼Œå†å®é™…æ“ä½œã€‚æ‚¨å¯ä»¥[æ–°é¡µé¢æŸ¥çœ‹é«˜æ¸…è§†é¢‘](https://www.bilibili.com/video/bv1JF411q7Ut/)





## ä¸‹è½½è¿è¡Œé¡¹ç›®

### ä¸‹è½½ä»£ç 

- [Github](https://github.com/marsgis/mars3d-vue-project)

```
git clone git@github.com:marsgis/mars3d-vue-project.git
```

- [Gitee](https://gitee.com/marsgis/mars3d-vue-project)ï¼šå›½å†…ç äº‘ï¼Œä¸‹è½½é€Ÿåº¦å¿«äº›ã€‚

```
git clone git@gitee.com:marsgis/mars3d-vue-project.git
```

### è¿è¡Œç¯å¢ƒ

- æ¨èä½¿ç”¨ vscodeï¼Œå®‰è£…å‚è€ƒ[å¼€å‘ç¯å¢ƒæ­å»ºæ•™ç¨‹](/guide/start/env.html)
- å®‰è£… vscode æ’ä»¶ï¼Œæ¨èå®‰è£… volarï¼ˆå¹¶ç¦ç”¨ veturï¼‰ã€ESlint ã€ Prettier
- é…ç½® vscode å‚æ•°

```json
// setting.jsonç›¸å…³é…ç½®
{
  "eslint.format.enable": true,
  "[json]": {
    "editor.defaultFormatter": "esbenp.prettier-vscode"
  },
  "[typescript]": {
    "editor.defaultFormatter": "esbenp.prettier-vscode"
  },
  "[javascript]": {
    "editor.defaultFormatter": "esbenp.prettier-vscode"
  },
  "[html]": {
    "editor.defaultFormatter": "esbenp.prettier-vscode"
  },
  "[vue]": {
    "editor.defaultFormatter": "esbenp.prettier-vscode"
  }
}
```

### è¿è¡Œå‘½ä»¤
è¯·å°†æœºå™¨Nodeç‰ˆæœ¬å‡çº§åˆ°v14åŠä»¥ä¸Šç‰ˆæœ¬

#### é¦–æ¬¡è¿è¡Œå‰å®‰è£…ä¾èµ–

```
npm install

//æˆ–ä½¿ç”¨ä»£ç†
npm i --registry=http://registry.taobao.org
```

#### å¯åŠ¨å¼€å‘ç¯å¢ƒ

```
npm run serve
```

#### ç¼–è¯‘æ„å»º

```
npm run build
npm run serve:dist  //æµ‹è¯•distè¿è¡ŒçŠ¶æ€
```

## è¿è¡Œæ•ˆæœ

è®¿é—®[åŸºç¡€é¡¹ç›® Vue ç‰ˆ](http://mars3d.cn/project/vue/index.html) åœ¨çº¿ä½“éªŒæ•ˆæœå’ŒåŠŸèƒ½
 
 ![image](http://marsgis.cn/img/project/mars3d-vue-project-jcxm/1.jpg)



## æµè§ˆå™¨æ”¯æŒ

æ¨èä½¿ç”¨`Chrome 90+` æµè§ˆå™¨ï¼Œ å»ºè®®å‡çº§æµè§ˆå™¨åˆ°æœ€æ–°ç‰ˆæœ¬è®¿é—®ã€‚

| IE | Edge | Firefox | Chrome | Safari |
| :-: | :-: | :-: | :-: | :-: |
| not support | last 2 versions | last 2 versions | last 2 versions | last 2 versions |

## å¦‚ä½•åé¦ˆé—®é¢˜ï¼Ÿ

- å‘ç°æ‚¨å‘ç°é¡¹ç›®ä¸­å­˜åœ¨çš„é—®é¢˜æˆ–è€…éœ€è¦ä¼˜åŒ–çš„åœ°æ–¹ï¼›
- å¦‚æœæ‚¨æœ‰ä¸€äº›è‡ªå·±å…¨æ–°ç¼–å†™çš„ç¤ºä¾‹ï¼Œå¸Œæœ›ä¹Ÿå¼€æºä¸å¤§å®¶åˆ†äº«ã€‚

æäº¤æ–¹å¼ï¼š

- æ¬¢è¿åœ¨ github æˆ– gitee ä¸Š[æäº¤ PR](https://www.baidu.com/s?wd=åœ¨GitHubä¸Šæäº¤PR)
- å¦‚æœå¯¹ git ä¸ç†Ÿæ‚‰ï¼Œä¹Ÿå¯ä»¥æ•´ç†ç¤ºä¾‹ä»£ç å‘é€é‚®ä»¶åˆ° wh@marsgis.cn ç”±æˆ‘ä»¬æ¥æ•´ç†é›†æˆã€‚

## é¡¹ç›®æ¶æ„

### æŠ€æœ¯é€‰å‹

- [node](http://nodejs.org/) å’Œ [git](https://git-scm.com/) ï¼šé¡¹ç›®å¼€å‘ç¯å¢ƒ 
- [Vue3](https://v3.cn.vuejs.org/api/)ï¼šå¼€å‘æ¡†æ¶
- [Vite](https://vitejs.dev/)ï¼šå¼€å‘ç¯å¢ƒ
- [TypeScript](https://www.tslang.cn/):å¼€å‘è¯­è¨€
- [Es6+](http://es6.ruanyifeng.com/) - ç†Ÿæ‚‰ es6 åŸºæœ¬è¯­æ³•
- [Ant Design Vue](https://next.antdv.com/components/overview-cn/)ï¼šUI æ§ä»¶åº“ 
- [ESlint](https://eslint.bootcss.com/)ï¼šä»£ç æ£€æŸ¥å·¥å…·
- [IconPark](https://iconpark.oceanengine.com/official)ï¼šUI å›¾æ ‡åº“ 

> éœ€è¦æœ‰ä¸€å®šçš„çŸ¥è¯†å‚¨å¤‡ï¼ŒåŒ…æ‹¬ vue3.0 ä¸­çš„ composition Api æ¨¡å¼ç­‰ï¼Œå»ºè®®æµè§ˆä¸‹[Web å‰ç«¯çŸ¥è¯†è§†é¢‘è®²è§£](https://www.bilibili.com/video/BV1xr4y1U73r/)


### ä¸»è¦ç›®å½•è¯´æ˜

```
mars3d-vue-project
â””â”€â”€â”€src                 ä¸»è¦é¡¹ç›®ä»£ç 
â”‚   â””â”€â”€â”€common          å…¬å…±æ ¸å¿ƒæ–‡ä»¶
â”‚   â””â”€â”€â”€components      å…¬å…±ç»„ä»¶
â”‚   â””â”€â”€â”€directive       æŒ‡ä»¤
â”‚   â””â”€â”€â”€misc            tsæ¨¡å—å®šä¹‰
â”‚   â””â”€â”€â”€pages           é¡µé¢å…¥å£
â”‚   â””â”€â”€â”€utils           å·¥å…·æ–¹æ³•
â”‚   â””â”€â”€â”€widget          åŠŸèƒ½ç›¸å…³çš„widgetæ§ä»¶ã€é‡è¦ã€‘
â”‚
â””â”€â”€â”€public              é™æ€èµ„æº
â”‚   â””â”€â”€â”€config          åœ°å›¾çš„é…ç½®æ–‡ä»¶ç­‰
â”‚   â””â”€â”€â”€img             å›¾ç‰‡èµ„æº
â”‚
â”‚â”€â”€â”€ .eslintrc.js        eslinté…ç½®æ–‡ä»¶
â”‚â”€â”€â”€ package.json        é¡¹ç›®é…ç½®ä¿¡æ¯
â””â”€â”€â”€ vite.config.ts      vite é…ç½®æ–‡ä»¶
â””â”€â”€â”€ tsconfig.js         ts é…ç½®æ–‡ä»¶
â””â”€â”€â”€ *.html              å„é¡µé¢å…¥å£
```

#### åŠŸèƒ½ä¸»ç›®å½•

é¡¹ç›®æ‰€æœ‰åŠŸèƒ½ä¸»è¦åœ¨ `src/widgets/*/*`ç›®å½•ä¸‹ï¼Œæ¯ä¸€ä¸ªåŠŸèƒ½å¯¹åº”äº†å¶å­ç›®å½•ä¸‹çš„ä¸€ä¸ª`index.vue`å’Œ `map.ts` æ–‡ä»¶ï¼Œå¤æ‚çš„ widget ç›®å½•ä¸‹ä¹Ÿä¼šæœ‰ç›¸å…³å­ç»„å»º `xxx.vue`ã€‚

vue ä¸‹çš„ widget è®¾è®¡ï¼Œæ²¿ç”¨äº†æˆ‘ä»¬ [åŸç”Ÿ JS ç‰ˆåŸºç¡€é¡¹ç›®](http://mars3d.cn/dev/guide/project/jcxm-es5.html)çš„è®¾è®¡ç†å¿µï¼š

- æ‰€æœ‰çš„ widget éƒ½æ˜¯æŒ‰éœ€åŠ è½½
- åªéœ€è¦é€šè¿‡ç®€å•çš„é…ç½®ï¼Œå³å¯æ§åˆ¶ä¸åŒä¸šåŠ¡é¢æ¿é—´çš„äº’æ–¥å…³ç³»
- æä¾› api å¯ä»¥æ‰‹åŠ¨çš„æ§åˆ¶é¢æ¿çš„æ˜¾ç¤ºéšè—

#### widget é…ç½®å‚æ•°

widget åŠ è½½ç›¸å…³çš„ä»£ç åœ¨ `src/common/store/widget.ts`ä¸‹ï¼Œä½¿ç”¨çš„ vuex ç®¡ç†ç›¸å…³çŠ¶æ€ï¼Œé»˜è®¤çŠ¶æ€å­—æ®µæœ‰

```ts
// ä¸º store state å£°æ˜ç±»å‹
export interface DefaultOption {
  autoDisable?: boolean
  disableOther?: boolean | string[]
  group?: string // groupç›¸åŒçš„widgetä¸€å®šæ˜¯äº’æ–¥çš„
  meta?: any // é¢å¤–å‚æ•° ä¸ä¼šåœ¨æ¯æ¬¡å…³é—­åæ¸…é™¤
}

export interface Widget {
  name: string // å”¯ä¸€æ ‡è¯†
  key?: string // ä½œä¸ºvue diff ç¯èŠ‚çš„keyï¼Œç”¨äºæ§åˆ¶ç»„ä»¶é‡è½½
  component?: any // widgetå…³è”çš„å¼‚æ­¥ç»„ä»¶
  autoDisable?: boolean // æ˜¯å¦èƒ½å¤Ÿè¢«è‡ªåŠ¨å…³é—­
  disableOther?: boolean | string[] // æ˜¯å¦è‡ªåŠ¨å…³é—­å…¶ä»–widget,æˆ–é€šè¿‡æ•°ç»„æŒ‡å®šéœ€è¦è¢«å…³é—­çš„widget
  group?: string // groupç›¸åŒçš„widgetä¸€å®šæ˜¯äº’æ–¥çš„
  visible?: boolean // æ˜¾ç¤ºéšè—
  data?: any // é¢å¤–ä¼ å‚ ä¼šåœ¨æ¯æ¬¡å…³é—­åæ¸…é™¤
  meta?: any // é¢å¤–å‚æ•° ä¸ä¼šåœ¨æ¯æ¬¡å…³é—­åæ¸…é™¤
}

export interface WidgetState {
  widgets: Widget[] // widgetå…·ä½“é…ç½®
  openAtStart: string[] // é»˜è®¤åŠ è½½çš„widget
  defaultOption?: DefaultOption // æ”¯æŒé…ç½®é»˜è®¤å‚æ•°
}
```

### widget æ„æµç¨‹å›¾

ç¤ºä¾‹çš„å†…éƒ¨æ„é€ å¤„ç†æµç¨‹å›¾ï¼š

![image](http://mars3d.cn/dev/img/guide/project-vue-liu.jpg)

## å¦‚ä½•å¢åŠ æ–°çš„ widget

ä¸‹é¢æˆ‘ä»¬ä»¥ `src/widgets/demo/sample-dialog/` ä¸ºç¤ºä¾‹åšè®²è§£

### 1.åˆ›å»ºç¤ºä¾‹

åœ¨ widgets ç›®å½•ä¸‹æŒ‰é¡¹ç›®éœ€è¦å»ºç«‹å¥½å¤šå±‚ç›®å½•ï¼Œæ¯”å¦‚æˆ‘ä»¬å°†æµ‹è¯•å’Œæ¼”ç¤ºçš„ widget æ”¾åœ¨`src/widgets/demo`ç›®å½•ä¸‹é¢ï¼ŒåŸºç¡€é¡¹ç›®çš„åŠŸèƒ½æ”¾åœ¨`src/widgets/basic`ç›®å½•ä¸‹ã€‚

é¦–å…ˆå»ºç«‹å sample-dialog ç›®å½•ï¼Œå¹¶å‚è€ƒå·²æœ‰ç¤ºä¾‹æ–°å»º`index.vue` å’Œ `map.ts` 2 ä¸ªæ–‡ä»¶ã€‚

#### index.vue

index.vue å®Œæ•´ä»£ç ä¸ºï¼š

```vue
<template>
  <mars-dialog title="å¼¹çª—æ ‡é¢˜" width="300" height="400" top="400" bottom="10" :right="10">
    <a-row :gutter="5">
      <a-col :span="19">
        <mars-input v-model:value="extent" :allowClear="true"></mars-input>
      </a-col>
      <a-col :span="5">
        <a-space size="small">
          <mars-button class="small-btn" @click="onClickDrawExtent">ç»˜åˆ¶</mars-button>
        </a-space>
      </a-col>
    </a-row>
    <template #icon>
      <bookmark-one theme="outline" size="18" />
    </template>
  </mars-dialog>
</template>

<script setup lang="ts">
import { onUnmounted, ref } from "vue"
import useLifecycle from "@mars/common/uses/use-lifecycle"
import MarsDialog from "@mars/components/mars-work/mars-dialog.vue"
import * as mapWork from "./map"

// å¯ç”¨map.tsç”Ÿå‘½å‘¨æœŸ
useLifecycle(mapWork)

const extent = ref("")

// æ¸²æŸ“æ¨¡å‹
const onClickDrawExtent = () => {
  // formState.extent = "æµ‹è¯•ç»„ä»¶å†…éƒ¨æ•°æ®æ˜¯å¦å“åº”"
  mapWork.drawExtent()
}
mapWork.eventTarget.on("drawExtent", function (event: any) {
  extent.value = event.extent
})

onUnmounted(() => {
  // é”€æ¯æ“ä½œ
})
</script>
<style lang="less"></style>
```

å…¶ä¸­ï¼š

##### mars-dialog.vue

mars-dialog æ˜¯å¼¹çª—ç»„ä»¶ï¼Œæˆ‘ä»¬ widget å†…å¯ä»¥æŒ‰éœ€é€‰æ‹©ä¸‹é¢ 2 ä¸ªä½¿ç”¨ï¼š

- mars-dialog å¼¹æ¡† ç»„ä»¶: `src/components/mars-work/mars-dialog.vue` 

mars-dialog æ”¯æŒçš„é…ç½®å‚æ•°åŒ…æ‹¬ï¼š

```ts
interface Props {
  warpper?: string // å®¹å™¨id é»˜è®¤æ˜¯appï¼Œå°†ä½œä¸ºå®šä½çš„å‚ç…§å…ƒç´ ï¼Œä¸€èˆ¬ä¸éœ€è¦ä¿®æ”¹
  title?: string // å¼¹æ¡†æ ‡é¢˜
  visible: boolean // æ˜¯å¦æ˜¾ç¤º
  width?: number | string // åˆå§‹å®½åº¦
  height?: number | string // åˆå§‹é«˜åº¦
  left?: number | string // å®šä½ leftå€¼
  right?: number | string // å®šä½rightå€¼
  top?: number | string // å®šä½topå€¼
  bottom?: number | string // å®šä½bottomå€¼
  handles?: boolean | string // ç¼©æ”¾æ§åˆ¶å™¨ é»˜è®¤ [x, y, xy]
  minWidth?: number // æœ€å°å®½åº¦
  minHeight?: number // æœ€å°é«˜åº¦
  maxWidth?: number // æœ€å¤§å®½åº¦
  maxHeight?: number // æœ€å¤§é«˜åº¦
  zIndex?: number // å±‚çº§
  customClass?: string // è‡ªå®šä¹‰class
}
```

##### é…ç½® widget çš„ props å‚æ•°

widget çš„ prop å‚æ•°é»˜è®¤æœ‰å››ä¸­é…ç½®æ–¹å¼ï¼Œé»˜è®¤æƒ…å†µä¸‹ä¼˜å…ˆçº§ä»ä½åˆ°é«˜åˆ†åˆ«ä¸º å†…è” propã€defaultOption ä¸­çš„ propsã€meta ä¸­çš„ props é…ç½®ï¼ŒåŠ¨æ€ä¼ å‚ï¼Œä½¿ç”¨æ–¹å¼å¦‚ä¸‹

```html
<!-- å†…è” -->
<mars-dialog title="å›¾ä¸Šé‡ç®—" width="300" height="530" top="50"></mars-dialog>
```

```js
// defaultOptionä¸­ æ³¨æ„ å¿…é¡»æ˜¯meta
const store: StoreOptions<State> = {
  state: {
    defaultOption: {
      meta: {
        props: {
          top: 110
        }
      }
    },
    widgets: []
  }
}
```

```js
// metaä¸­
widgets = [
  {
    component: markRaw(defineAsyncComponent(() => import("@mars/widgets/hello.vue"))),
    name: "hello",
    autoDisable: true,
    meta: {
      props: {
        top: 70
      }
    }
  }
]
```

```js
// åŠ¨æ€ä¼ å‚
activate({
  name: "hello",
  data: {
    props: {
      top: 70
    }
  }
})
```

> ä»¥ä¸Šå‡ä¸ºé»˜è®¤æƒ…å†µä¸‹çš„å¤„ç†ï¼Œå†æŸäº›ç‰¹æ®Šæƒ…å†µä¸‹ï¼Œå¯ä»¥åœ¨ widget ä¸­é€šè¿‡ä¸‹é¢è¿™ç§æ–¹å¼ï¼Œå¼ºåˆ¶å°†å†…è” props çš„ä¼˜å…ˆçº§æå‡åˆ°æœ€é«˜

```html
<mars-dialog v-bind="attrs" title="hello" width="300" height="530" top="50" :right="10" :min-width="297"></mars-dialog>

<script>
  import { useAttrs } from "vue"
  const attrs = useAttrs()
</script>
```

##### useLifecycle

vue ä¸­éœ€è¦è°ƒç”¨åœ°å›¾æ–¹æ³•æ—¶ï¼Œéœ€å¾—å¯ç”¨ map.ts çš„ç”Ÿå‘½å‘¨æœŸï¼Œå¹¶ä¸”åœ¨ map.ts ç”Ÿå‘½å‘¨æœŸä¸­è·å– map å¯¹è±¡ã€‚

```js
// vueä¸­
import useLifecycle from "@mars/common/uses/use-lifecycle"
import * as mapWork from "./map"

// å¯ç”¨map.tsç”Ÿå‘½å‘¨æœŸ
useLifecycle(mapWork)
```

> æ³¨æ„ï¼š
>
> 1. å¼€å¯ç”Ÿå‘½å‘¨æœŸçš„æ“ä½œåªéœ€è¦åœ¨ index.vue ä¸­æ‰§è¡Œï¼Œå­ç»„ä»¶ä¸éœ€è¦
> 2. å°½é‡ä¸è¦åœ¨ vue çš„ç”Ÿå‘½å‘¨æœŸä¸­æ“ä½œ mapï¼Œæˆ–è€…è°ƒç”¨ map.ts ä¸­æ“ä½œ map çš„å‡½æ•°ï¼Œæ­¤æ—¶æ“ä½œä¸èƒ½ä¿è¯ map å­˜åœ¨

#### map.ts

map.ts å®Œæ•´ä»£ç ä¸ºï¼š

```ts
import * as mars3d from "mars3d"

export let map: mars3d.Map // åœ°å›¾å¯¹è±¡

// äº‹ä»¶å¯¹è±¡ï¼Œç”¨äºæŠ›å‡ºäº‹ä»¶ç»™vue
export const eventTarget = new mars3d.BaseClass()

// åˆå§‹åŒ–å½“å‰ä¸šåŠ¡
export function onMounted(mapInstance: mars3d.Map): void {
  map = mapInstance // è®°å½•map
}

// é‡Šæ”¾å½“å‰ä¸šåŠ¡
export function onUnmounted(): void {
  map = null
}

// ç»˜åˆ¶çŸ©å½¢ï¼ˆæ¼”ç¤ºmap.jsä¸index.vueçš„äº¤äº’ï¼‰
export function drawExtent(): void {
  map.graphicLayer.clear()
  // ç»˜åˆ¶çŸ©å½¢
  map.graphicLayer.startDraw({
    type: "rectangle",
    style: {
      fill: true,
      color: "rgba(255,255,0,0.2)",
      outline: true,
      outlineWidth: 2,
      outlineColor: "rgba(255,255,0,1)"
    },
    success: function (graphic: mars3d.graphic.RectangleEntity) {
      const rectangle = graphic.getRectangle({ isFormat: true })
      eventTarget.fire("drawExtent", { extent: JSON.stringify(rectangle) }) // æŠ›å‡ºäº‹ä»¶ï¼Œå¯ä»¥vueä¸­å»ç›‘å¬äº‹ä»¶
    }
  })
}
```

å…¶ä¸­ï¼š

##### onMounted

åˆå§‹åŒ–å½“å‰åœ°å›¾ä¸šåŠ¡çš„é’©å­æ–¹æ³•ï¼Œå¯ä»¥é€šè¿‡ onMounted å‡½æ•°çš„è·å–åˆ° map ä¸»å¯¹è±¡ã€‚

```js
export function onMounted(mapInstance: mars3d.Map): void {
  map = mapInstance // è®°å½•map åˆå§‹åŒ–å½“å‰ä¸šåŠ¡
}
```

å¦‚æœæœªè°ƒç”¨ï¼Œè¯·è¯·å‚è€ƒä¹‹å‰çš„æ­¥éª¤ï¼Œæ£€æŸ¥æ˜¯å¦æ­£å¸¸ä½¿ç”¨`useLifecycle(mapWork)`å¯ç”¨ç”Ÿå‘½å‘¨æœŸ

##### onUnmounted

é‡Šæ”¾å½“å‰åœ°å›¾ä¸šåŠ¡çš„é’©å­æ–¹æ³•,
ä¸€èˆ¬åœ¨ onMounted æ·»åŠ çš„å›¾å±‚ã€ç»‘å®šçš„äº‹ä»¶ï¼Œåœ¨ onUnmounted ä¸­éƒ½éœ€è¦åšç›¸åçš„ç§»é™¤ã€è§£ç»‘ç­‰æ“ä½œã€‚

```js
export function onUnmounted(): void {
  map = null // é‡Šæ”¾å½“å‰ä¸šåŠ¡
}
```

#### `map.ts`å’Œ`index.vue`å„è‡ªä»£ç ä¸šåŠ¡åˆ†ç¦»çš„åŸåˆ™

- æ¶‰åŠåœ°å›¾ä¸šåŠ¡çš„æ“ä½œå‡å†™åœ¨ map.ts ä¸­
- æ¶‰åŠ UI å±‚é¢ã€å’Œåœ°å›¾æ— å…³çš„æ“ä½œå‡å†™åœ¨ index.vue ä¸­,vue ä¸­å°½é‡ä¸ä½¿ç”¨ mars3d å’Œ Cesium å¼€å¤´çš„ç±»

#### index.vue ä¸ map.ts äº¤äº’

1. index.vue ç›´æ¥è°ƒç”¨ map.ts ä¸­ å¯¼å‡ºçš„å‡½æ•°æˆ–å¯¹è±¡
2. index.vue è°ƒç”¨ map.ts ä¸­çš„å‡½æ•°æ‹¿åˆ°è¿”å›å€¼ï¼Œç»§ç»­åç»­å¤„ç†ï¼Œå¼‚æ­¥æ“ä½œè¿”å›å€¼å¯ä»¥æ˜¯ Promise
3. map.ts ä¸»åŠ¨è§¦å‘ ui å˜åŒ–ï¼Œé€šè¿‡ mars3d.BaseClass äº‹ä»¶ä¸­å¿ƒå¤„ç†ã€‚å¦‚

```ts
// map.ts
export const eventTarget = new mars3d.BaseClass()

function change() {
  mapWork.eventTarget.fire("change", { value: "hello change" })
}

// index.vue
import * as mapWork from "./map"
const change = (e: any) => {
  console.log(e)
}
mapWork.eventTarget.on("change", change)

onUnmounted(() => {
  mapWork.eventTarget.off("change", change) // æ³¨æ„ï¼šè¯·åŠæ—¶é”€æ¯äº‹ä»¶ç»‘å®š
})
```

### 2.ç›¸å…³é¡µé¢åŠ å…¥èœå•å…¥å£

#### store.ts æ¸…å•é…ç½®

åœ¨å¯¹åº” page é¡µé¢ä¸‹çš„ `src/pages/demo/widget-store.ts` ä¸­ï¼Œéœ€è¦é…ç½®åˆšæ‰æ–°å»ºçš„ widget ç›¸å…³ä¿¡æ¯ï¼›

```js
import { defineAsyncComponent, markRaw } from "vue"
import { WidgetState } from "@mars/common/store/widget"
import { StoreOptions } from "vuex"

const store: StoreOptions<WidgetState> = {
  state: {
    //å·²å¿½ç•¥å…¶ä»–é…ç½®
    widgets: [
      {
        component: markRaw(defineAsyncComponent(() => import("@mars/widgets/demo/sample-dialog/index.vue"))),
        name: "sample-dialog"
      }
    ]
  }
}
export default store
```

> å…¶ä¸­ state ä¸‹çš„é…ç½®å‚æ•°å‚è€ƒ `widget é…ç½®å‚æ•°`

> æ›´å¤šå‚æ•°å»ºè®®é˜…è¯»æºç çš„ `src/common/store/widget.ts` (æ•™ç¨‹å¯èƒ½æ»åï¼Œè¯·å‚è€ƒæºç æ³¨é‡Šä¸ºå‡†)

#### èœå•æˆ–å…¶ä»–å…¥å£æ–‡ä»¶ä¸­

åœ¨éœ€è¦çš„èœå•å•å‡»äº‹ä»¶æˆ–å…¶ä»–å¯¹è±¡è§¦å‘ä»£ç ä¸­ï¼ŒåŠ å…¥`activate('sample-dialog')`æ¥æ¿€æ´»æˆ‘ä»¬åˆšåŠ å…¥çš„æ§ä»¶ï¼Œ

ä¸‹é¢å·²ç›®å½•ä¸ºä¾‹ï¼š

åœ¨`widgets/demo/menu/index.vue`ä¸­åŠ å…¥â€œå¼¹çª—ç¤ºä¾‹â€æŒ‰é’®ï¼ŒæŒ‰é’®å•å‡»äº‹ä»¶è°ƒç”¨å¯¹åº”æ–¹æ³•ï¼Œ

activate å’Œ disable å‡½æ•°æ”¯æŒ stringï¼ˆç›´æ¥ä¼ é€’ nameï¼‰ å’Œ Widgetï¼ˆä¼ é€’ widget å¯¹è±¡ï¼Œå°†ä¼šåˆå¹¶ä¼ é€’çš„å±æ€§ï¼Œå¿…é¡»åŒ…å« name å­—æ®µï¼‰ ç±»å‹çš„å‚æ•°ï¼Œä¸Šè¿° name å­—æ®µä¸ store.ts ä¸­çš„ name éœ€è¦ä¸€è‡´ã€‚

```vue
<template>
  <mars-dialog :draggable="false">
    <a-space>
      <mars-button @click="show('sample-pannel')">é¢æ¿ç¤ºä¾‹</mars-button>
      <mars-button @click="show('sample-dialog')">å¼¹çª—ç¤ºä¾‹</mars-button>
      <mars-button @click="show('ui')">UIé¢æ¿</mars-button>
    </a-space>
  </mars-dialog>
</template>

<script setup lang="ts">
import MarsDialog from "@mars/components/mars-work/mars-dialog.vue"
import { useWidget } from "@mars/common/store/widget"

const { activate } = useWidget()

const show = (name: string) => {
  activate(name)
  // æˆ–
  activate({
    name
  })
}
</script>
<style lang="less"></style>
```

## å°†å½“å‰é¡¹ç›®é›†æˆåˆ°è‡ªå·±çš„é¡¹ç›®ä¸­(åˆå¹¶ 2 ä¸ªé¡¹ç›®)

å¯ä»¥å‚è€ƒå·²é›†æˆå¥½çš„mars3d-vue-project-adminé¡¹ç›®:
[github:vue-mars3d-admin](https://github.com/marsgis/mars3d-vue-project-admin)ã€
[gitee:vue-mars3d-admin](https://gitee.com/marsgis/mars3d-vue-project-admin)

> å‰ææ¡ä»¶ï¼šéœ€è¦ 2 ä¸ªé¡¹ç›®çš„æŠ€æœ¯æ ˆåŸºæœ¬æ˜¯ä¸€è‡´çš„ï¼Œæ¯”å¦‚`vue3+ts+ant-design-vue`ç­‰


### æµç¨‹æ¦‚è§ˆï¼š

éœ€è¦æ‹·è´çš„ç›®å½•å’Œæ–‡ä»¶ï¼š

- `/src/` æ‹·è´åˆ° `/src/marsgis`
- `/public/` æ‹·è´åˆ° `/public/`
- `/src/pages/index/widget-store.ts` æ‹·è´åˆ°`/src/marsgis/widget-store.ts`

éœ€è¦ä¿®æ”¹è‡ªå·±é¡¹ç›®çš„æ–‡ä»¶ï¼š

- `package.json`
- `vite.config.ts` æˆ– `vue.config.js`
- `src/main.js`
- éœ€è¦åŠ åœ°å›¾çš„`vueæ–‡ä»¶`

![image](http://mars3d.cn/dev/img/guide/project-vue-hebing.jpg)

### 1. æ‹·è´åŸºç¡€é¡¹ç›® src ä»£ç 

åœ¨åŸæœ‰é¡¹ç›®ä¸­æ–°å»ºç›®å½•`src/marsgis`ï¼Œå°†åŸºç¡€é¡¹ç›® src ä»£ç æ‹·è´åˆ°`src/marsgis`ç›®å½•ä¸‹é¢ï¼Œå…¶ä¸­ pages ç›®å½•éå¿…é¡»ï¼Œå¯ä»¥æŒ‰éœ€æ‹·è´ã€‚

### 2. æ‹·è´ public ä¸‹çš„èµ„æº

å°†åŸºç¡€é¡¹ç›®`public`ä¸‹æ‰€æœ‰æ–‡ä»¶æ‹·è´åˆ°è‡ªå·±é¡¹ç›®çš„`public`ç›®å½•ä¸‹ã€‚

### 3. package.json ä¾èµ–çš„èåˆ

å¤åˆ¶ package.json ä¾èµ–åŒ…ï¼Œä¿è¯ä¾èµ–å­˜åœ¨ä¸”ç‰ˆæœ¬æ­£ç¡®ã€‚

```json
// dependenciesä¸­æ·»åŠ 
{
  "mars3d": "^3.4.0",
  "mars3d-cesium": "^1.93.0",
  "@turf/turf": "^6.5.0",
  "kml-geojson": "^1.2.0",
  "vue": "^3.2.26",
  "vuex": "^4.0.2",
  "vue-color-kit": "^1.0.5",
  "axios": "^0.23.0",
  "core-js": "^3.6.5",
  "ant-design-vue": "^3.2.5",
  "@icon-park/vue-next": "^1.3.5",
  "nprogress": "^0.2.0",
  "echarts": "^5.2.2",
  "localforage": "^1.10.0"
}
```

### 4. ä¿®æ”¹é¡¹ç›®åˆ«åç­‰é…ç½®

ä¿®æ”¹`vite.config.ts` æˆ– `vue.config.js` é…ç½®æ–‡ä»¶ä¸­çš„é¡¹ç›®åˆ«åé…ç½®å’Œ process ç›¸å…³é…ç½®

```js
alias: {
  {
    find: /@mars\//,
    replacement: pathResolve('src/marsgis') + '/',
  }
}

define: {
  'process.env': {
    BASE_URL: '/',
  },
}
```

### 5. ä¿®æ”¹åˆå§‹åŒ–ç›¸å…³ä¾èµ–

å°†`src/pages/index/widget-store.ts`é…ç½®æ–‡ä»¶æ‹·è´`src/marsgis/widget-store.ts`ä½ç½®ã€‚

å†åœ¨`src/main.js`æ–‡ä»¶ä¸­åŠ è½½å’Œåˆå§‹åŒ–ç›¸å…³ä¾èµ–ã€‚

```js
import { injectState, key } from "@mars/common/store/widget"
import widgetStore from "@mars/widget-store"
import MarsUI from "@mars/components/mars-ui"

app.use(MarsUI)
app.use(injectState(widgetStore), key)
```

### 6.å¤åˆ¶å¯¹åº” vue é¡µé¢ä»£ç 

å¤åˆ¶å¯¹åº”é¡µé¢ä»£ç åˆ°ç»„ä»¶ä¸­, ä¾‹å¦‚æ‹·è´ `src/pages/index/App.vue` ä»£ç åˆ°è‡ªå·±é¡¹ç›®éœ€è¦å±•ç¤ºåœ°å›¾çš„ vue æ–‡ä»¶ä¸­ã€‚

### 7. åˆå¹¶é¡¹ç›®è§„èŒƒç­‰é…ç½®ä¿¡æ¯(å¯é€‰)

å¦‚æœæ²¡æœ‰ä¸‹é¢æ–‡ä»¶ï¼Œå¯ä»¥ç›´æ¥æ‹·è´åˆ°è‡ªå·±é¡¹ç›®ä¸­ï¼Œ
å¦‚æœå·²æœ‰å¯¹åº”æ–‡ä»¶ï¼Œå¯ä»¥å¯¹æ¯”å‚æ•°ï¼ŒæŒ‰éœ€æ‹·è´ç›¸å…³é…ç½®è¿›å·²æœ‰æ–‡ä»¶ä¸­ã€‚

- å¤åˆ¶`/.editorconfig` æ–‡ä»¶åˆ°`src/marsgis/`ç›®å½•ä¸‹
- å¤åˆ¶`/.eslintrc.js` æ–‡ä»¶åˆ°`src/marsgis/`ç›®å½•ä¸‹
- å¤åˆ¶`/.prettierrc` æ–‡ä»¶åˆ°`src/marsgis/`ç›®å½•ä¸‹
- ä¿®æ”¹`/tsconfig.json` æ–‡ä»¶

> å¦‚æœé¡¹ç›®ä¸­é‡‡ç”¨çš„ eslint æ ‡å‡†åº“ä¸åŸºç¡€é¡¹ç›®ä¸ä¸€è‡´ï¼Œåˆ™æ ¹æ®æç¤ºå®‰è£…å¯¹åº”çš„ä¾èµ–ï¼Œç›¸å…³ä¾èµ–å¦‚ä¸‹, æŒ‰ç…§é¡¹ç›®å®é™…æƒ…å†µå®‰è£…ï¼Œå¹¶ä½œç›¸åº”è°ƒæ•´.


### 8. å¤„ç†æ ·å¼å†²çª

åŸºç¡€é¡¹ç›®å·²ç»åŸºæœ¬ä¿è¯ä¸ä¼šå½±å“å¤–éƒ¨æ ·å¼ï¼Œæ­¤å¤„è¦å¤„ç†çš„æ˜¯æ‚¨é¡¹ç›®ä¸­çš„å…¨å±€æ ·å¼å¯¹ mars3d ç›¸å…³ç»„ä»¶çš„å½±å“ã€‚ä¿®æ”¹ç›¸å…³ CSS ä¿è¯åŸºç¡€é¡¹ç›®åŠŸèƒ½ UI æ­£å¸¸å³å¯ã€‚

## å¼€å‘ä¸­å¸¸è§é—®é¢˜


### 1. å¦‚ä½•åˆ‡æ¢mars3dåˆ°æˆæƒç‰ˆ

 å‚è€ƒ [è·å–Mars3D](http://mars3d.cn/dev/guide/start/download.html)ä¸­â€œä» Mars3Då®˜ç½‘ ä¸‹è½½è·å–â€ç« èŠ‚ä»‹ç»ã€‚

æµç¨‹å¤§æ¦‚æ˜¯ï¼š
- é…ç½®åï¼Œæ— éœ€æ”¹åŠ¨æºç ï¼Œåœ¨é¡¹ç›®ä»£ç ä¸­ä½¿ç”¨æ—¶ä¸ä½¿ç”¨npmåŒ…æ˜¯ä¸€æ ·çš„æ–¹å¼ï¼Œå¦‚ `import * as mars3d from "mars3d";`
- å°† npm å®‰è£…åçš„`node_modules/mars3d/`ä¸‹çš„æ‰€æœ‰æ–‡ä»¶æ‹·è´ä¸€ä»½æ”¾åœ¨`packages/mars3d/`ç›®å½•ã€‚
- å°†`mars3d-sdk.rar`ç¦»çº¿åŒ…å†…æ–‡ä»¶ è¦†ç›–è‡³`packages/mars3d/dist/`ç›®å½•ä¸‹ã€‚
- ä¿®æ”¹`package.json`ä¸­mars3dåŒ…é…ç½®ä¸ºï¼š` "mars3d": "file:packages/mars3d",`
 
![image](http://mars3d.cn/dev/img/guide/basics-download-import.jpg)


### 2. å±€åŸŸç½‘ç¦»çº¿ä½¿ç”¨æ—¶æ³¨æ„äº‹é¡¹

å¹³å°æ‰€æœ‰ä»£ç å±‚é¢æ¥è¯´æ”¯æŒç¦»çº¿è¿è¡Œå’Œä½¿ç”¨çš„ï¼Œä½†éœ€è¦æ³¨æ„çš„æ˜¯ç¦»çº¿æ—¶çš„åœ°å›¾æœåŠ¡çš„ç›¸å…³å¤„ç†ã€‚

å¦‚æœå±€åŸŸç½‘å†…æœ‰ç›¸å…³åœ°å½¢ã€å«æ˜Ÿåº•å›¾æœåŠ¡å¯ä»¥æŒ‰å†…ç½‘æœåŠ¡ç±»å‹å’Œ URL åœ°å€æ›¿æ¢ä¸‹`config.json`æˆ–`æ„é€ Mapçš„ä»£ç ä¸­`çš„é»˜è®¤åœ°å½¢å’Œåº•å›¾ã€‚

å¦‚æœå±€åŸŸç½‘å†…æ²¡æœ‰ç›¸å…³æœåŠ¡ï¼Œå¯ä»¥æŒ‰ä¸‹é¢å¤„ç†ï¼š

- ä¿®æ”¹ config.json ä¸­`terrain`é…ç½®ä¸­ï¼Œå°†å·²æœ‰çš„`"show": true`é…ç½®ï¼Œæ”¹ä¸º`"show": false`
- ä¿®æ”¹ config.json ä¸­`basemaps`æ•°ç»„é…ç½®ä¸­ï¼Œå°†å·²æœ‰çš„`"show": true`çš„å›¾å±‚ï¼Œå°†è¯¥å€¼æ”¹ä¸º`"show": false` ï¼Œå¹¶å°†å•å¼ å›¾ç‰‡æˆ–ç¦»çº¿åœ°å›¾åŠ ä¸Š`"show": true`ï¼Œå¹¶ä¿®æ”¹ç›¸å…³ URL åœ°å€ã€‚
- æ‚¨ä¹Ÿå¯ä»¥å‚è€ƒæ•™ç¨‹[å‘å¸ƒä¸‰ç»´æ•°æ®æœåŠ¡](http://mars3d.cn/dev/guide/data/server.html)è¿›è¡Œéƒ¨ç½²ç¦»çº¿åœ°å›¾æœåŠ¡ï¼Œé‡Œé¢ä¹Ÿæœ‰ä¸€äº›ç¤ºä¾‹ç¦»çº¿æ•°æ®ã€‚

## Mars3D æ˜¯ä»€ä¹ˆ

> `Mars3Då¹³å°` æ˜¯[ç«æ˜Ÿç§‘æŠ€](http://marsgis.cn/)ç ”å‘çš„ä¸€æ¬¾åŸºäº WebGL æŠ€æœ¯å®ç°çš„ä¸‰ç»´å®¢æˆ·ç«¯å¼€å‘å¹³å°ï¼ŒåŸºäº[Cesium](https://cesium.com/cesiumjs/)ä¼˜åŒ–æå‡ä¸ B/S æ¶æ„è®¾è®¡ï¼Œæ”¯æŒå¤šè¡Œä¸šæ‰©å±•çš„è½»é‡çº§é«˜æ•ˆèƒ½ GIS å¼€å‘å¹³å°ï¼Œèƒ½å¤Ÿå…å®‰è£…ã€æ— æ’ä»¶åœ°åœ¨æµè§ˆå™¨ä¸­é«˜æ•ˆè¿è¡Œï¼Œå¹¶å¯å¿«é€Ÿæ¥å…¥ä¸ä½¿ç”¨å¤šç§ GIS æ•°æ®å’Œä¸‰ç»´æ¨¡å‹ï¼Œå‘ˆç°ä¸‰ç»´ç©ºé—´çš„å¯è§†åŒ–ï¼Œå®Œæˆå¹³å°åœ¨ä¸åŒè¡Œä¸šçš„çµæ´»åº”ç”¨ã€‚

> Mars3D å¹³å°å¯ç”¨äºæ„å»ºæ— æ’ä»¶ã€è·¨æ“ä½œç³»ç»Ÿã€ è·¨æµè§ˆå™¨çš„ä¸‰ç»´ GIS åº”ç”¨ç¨‹åºã€‚å¹³å°ä½¿ç”¨ WebGL æ¥è¿›è¡Œç¡¬ä»¶åŠ é€Ÿå›¾å½¢åŒ–ï¼Œè·¨å¹³å°ã€è·¨æµè§ˆå™¨æ¥å®ç°çœŸæ­£çš„åŠ¨æ€å¤§æ•°æ®ä¸‰ç»´å¯è§†åŒ–ã€‚é€šè¿‡ Mars3D äº§å“å¯å¿«é€Ÿå®ç°æµè§ˆå™¨å’Œç§»åŠ¨ç«¯ä¸Šç¾è§‚ã€æµç•…çš„ä¸‰ç»´åœ°å›¾å‘ˆç°ä¸ç©ºé—´åˆ†æã€‚

### ç›¸å…³ç½‘ç«™

- Mars3D å®˜ç½‘ï¼š[http://mars3d.cn](http://mars3d.cn)

- Mars3D å¼€æºé¡¹ç›®åˆ—è¡¨ï¼š[https://github.com/marsgis/mars3d](https://github.com/marsgis/mars3d)

## ç‰ˆæƒè¯´æ˜

1. Mars3D å¹³å°ç”±[ç«æ˜Ÿç§‘æŠ€](http://marsgis.cn/)è‡ªä¸»ç ”å‘ï¼Œæ‹¥æœ‰æ‰€æœ‰æƒåˆ©ã€‚
2. ä»»ä½•ä¸ªäººæˆ–ç»„ç»‡å¯ä»¥åœ¨éµå®ˆç›¸å…³è¦æ±‚ä¸‹å¯ä»¥å…è´¹æ— é™åˆ¶ä½¿ç”¨ã€‚
